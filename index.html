<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>–í–æ–≤–∞ 2: –ö–æ—Ä–æ–ª—å –ë–∏–≥ –•–∏—Ç–æ–≤</title>
    <script src="https://telegram.org"></script>
    <style>
        :root {
            --gold: #ffd700; --nagets: #ff6600; --bg: #050505; --prestige: #e5e4e2;
            --common: #bdc3c7; --rare: #00d2ff; --mythic: #a100ff; --legendary: #ffae00;
        }
        body { font-family: 'Arial Black', sans-serif; background: var(--bg); color: white; margin: 0; padding: 0; display: flex; height: 100vh; overflow: hidden; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        #game-view { flex: 1.4; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; background: radial-gradient(circle, #222, #000); border-right: 2px solid #333; }
        .stats-panel { position: absolute; top: 15px; text-align: center; z-index: 10; background: rgba(0,0,0,0.8); padding: 10px 20px; border-radius: 15px; border: 2px solid var(--gold); min-width: 150px; }
        .money { font-size: 1.8rem; color: var(--gold); line-height: 1; }
        
        #burger-btn { font-size: 120px; cursor: pointer; transition: transform 0.05s; z-index: 5; margin-top: 40px; }
        #burger-btn:active { transform: scale(0.9); }

        #shop { flex: 1; background: #111; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; }
        .tabs { display: flex; gap: 4px; margin-bottom: 15px; position: sticky; top: 0; background: #111; z-index: 20; padding-bottom: 5px; }
        .tab-btn { flex: 1; padding: 10px 2px; border: none; background: #222; color: #777; cursor: pointer; border-radius: 6px; font-size: 0.6rem; font-weight: bold; }
        .tab-btn.active { background: var(--gold); color: black; }

        .item { background: #1a1a1a; padding: 12px; margin-bottom: 10px; border-radius: 10px; border-left: 5px solid #444; border: 1px solid #222; flex-shrink: 0; }
        .item.legendary { border-left-color: var(--legendary); border-color: var(--legendary); background: linear-gradient(90deg, #1a1a1a, #2a1a00); }
        .item b { display: block; font-size: 0.9rem; color: var(--gold); }
        .item .profit { font-size: 0.7rem; color: #4caf50; margin: 3px 0; display: block; }

        .buy-btn { width: 100%; padding: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; background: #27ae60; color: white; margin-top: 5px; }
        .buy-btn:disabled { background: #333 !important; color: #666 !important; cursor: not-allowed; }

        #dima-game { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; z-index: 1000; flex-direction: column; align-items: center; justify-content: center; }
        .falling-nagets { position: absolute; font-size: 40px; user-select: none; filter: drop-shadow(0 0 10px var(--nagets)); }
        .f-text { position: absolute; pointer-events: none; animation: fly 0.6s forwards; font-weight: bold; font-size: 1.4rem; z-index: 100; color: var(--gold); text-shadow: 1px 1px #000; }
        @keyframes fly { 0% { opacity: 1; transform: translateY(0); } 100% { opacity: 0; transform: translateY(-100px); } }
    </style>
</head>
<body>

<div id="game-view">
    <div class="stats-panel">
        <div id="loc-display" style="font-size: 0.6rem; color: #aaa; text-transform: uppercase; margin-bottom: 5px;">–ú–∞—Ö–∞—á–∫–∞–ª–∞</div>
        <div class="money" id="money-display">0 –ë–•</div>
        <div style="font-size: 0.8rem; margin-top: 5px; display: flex; justify-content: center; gap: 10px;">
            <span style="color: var(--nagets)">üçó <span id="nagets-display">0</span></span>
            <span style="color: var(--prestige)">üëë <span id="prestige-display">0</span></span>
        </div>
    </div>
    
    <div id="burger-btn">üçî</div>
    <div id="income-stats" style="margin-top: 15px; color: #555; font-size: 0.7rem;">–ê–≤—Ç–æ: 0/—Å–µ–∫</div>
</div>

<div id="shop">
    <div class="tabs">
        <button class="tab-btn active" id="t-upg" onclick="changeTab('upg')">–£–õ–£–ß–®–ï–ù–ò–Ø</button>
        <button class="tab-btn" id="t-loc" onclick="changeTab('loc')">–ú–ò–†</button>
        <button class="tab-btn" id="t-skin" onclick="changeTab('skin')">–ê–†–¢–´</button>
        <button class="tab-btn" id="t-bunker" onclick="changeTab('bunker')">–ë–£–ù–ö–ï–†</button>
    </div>
    <div id="shop-content"></div>
</div>

<div id="dima-game">
    <h2 style="color: var(--nagets)">–ó–ê–ñ–ú–ò –ò –°–û–ë–ò–†–ê–ô!</h2>
    <div id="game-timer" style="font-size: 3rem;">10</div>
</div>

<script>
    const tg = window.Telegram.WebApp;
    tg.expand();
    tg.setHeaderColor('#050505');

    function vib(type = 'light') { if (tg.HapticFeedback) tg.HapticFeedback.impactOccurred(type); }

    let state = JSON.parse(localStorage.getItem('vova_vFinal_v1')) || {
        money: 0, nagets: 0, prestigeGold: 0, click: 1, auto: 0, mult: 1, locIdx: 0, 
        upgLvl: {}, totalClicks: 0, skins: { current: 'üçî' }, unlockedSkins: ['üçî']
    };

    let activeTab = 'upg';
    let mDown = false;
    const setM = (v) => mDown = v;
    window.onmousedown = () => setM(true); window.onmouseup = () => setM(false);
    window.ontouchstart = () => setM(true); window.ontouchend = () => setM(false);

    const upgrades = [
        { id: 'u1', name: "–û—Å—Ç—Ä—ã–π –ø–µ—Ä–µ—Ü", base: 15, pow: 2, type: 'click', r: 'common', d: "+2 –∫ –∫–ª–∏–∫—É" },
        { id: 'u2', name: "–°—Ç—É–¥–µ–Ω—Ç-–∫—É—Ä—å–µ—Ä", base: 100, pow: 5, type: 'auto', r: 'common', d: "+5 –ë–•/—Å–µ–∫" },
        { id: 'u3', name: "–î–≤–æ–π–Ω–∞—è –∫–æ—Ç–ª–µ—Ç–∞", base: 500, pow: 15, type: 'click', r: 'rare', d: "+15 –∫ –∫–ª–∏–∫—É" },
        { id: 'u4', name: "–ì—Ä–∏–ª—å-–º–∞—à–∏–Ω–∞", base: 2000, pow: 50, type: 'auto', r: 'rare', d: "+50 –ë–•/—Å–µ–∫" },
        { id: 'u5', name: "–ó–æ–ª–æ—Ç–∞—è —Ñ—Ä–∞–Ω—à–∏–∑–∞", base: 10000, pow: 2, type: 'mult', r: 'rare', d: "–î–æ—Ö–æ–¥ x2" },
        { id: 'u6', name: "SMM –ú–µ–Ω–µ–¥–∂–µ—Ä", base: 25000, pow: 200, type: 'auto', r: 'rare', d: "+200 –ë–•/—Å–µ–∫" },
        { id: 'u7', name: "–í–µ—Ä—Ç–æ–ª–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∏", base: 80000, pow: 700, type: 'auto', r: 'mythic', d: "+700 –ë–•/—Å–µ–∫" },
        { id: 'u8', name: "–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç", base: 250000, pow: 2000, type: 'click', r: 'mythic', d: "+2–∫ –∫ –∫–ª–∏–∫—É" },
        { id: 'u9', name: "–ö–æ—Å–º–∏—á–µ—Å–∫–∏–π –º–∞—Ä–∫–µ—Ç–∏–Ω–≥", base: 600000, pow: 3, type: 'mult', r: 'mythic', d: "–î–æ—Ö–æ–¥ x3" },
        { id: 'l1', name: "üçó –ö–û–†–û–õ–¨ –ú–ò–†–ê", base: 20, pow: 10, type: 'mult', r: 'legendary', cur: 'n', d: "–î–æ—Ö–æ–¥ x10" },
        { id: 'l2', name: "üçó –ß–∏—Ç—ã –æ—Ç –î–∏–º—ã", base: 100, pow: 100000, type: 'auto', r: 'legendary', cur: 'n', d: "+100–∫ –ë–•/—Å–µ–∫" },
        { id: 'l3', name: "üçó –ö–≤–∞–Ω—Ç–æ–≤—ã–π —Å–æ—É—Å", base: 250, pow: 200000, type: 'click', r: 'legendary', cur: 'n', d: "+200–∫ –∫ –∫–ª–∏–∫—É" }
    ];

    const locations = [
        { n: "–ú–ê–•–ê–ß–ö–ê–õ–ê", req: 0, m: 1 }, { n: "–¢–£–†–¶–ò–Ø", req: 15000, m: 5 },
        { n: "–°–®–ê", req: 300000, m: 25 }, { n: "–Ø–ü–û–ù–ò–Ø", req: 2000000, m: 100 },
        { n: "–ú–ê–†–°", req: 100000000, m: 1000 }
    ];

    const skinData = {
        'üçî': { n: "–û–±—ã—á–Ω—ã–π", b: "–ù–µ—Ç", req: 0, t: "–°—Ç–∞—Ä—Ç" },
        'üìÄ': { n: "–ó–æ–ª–æ—Ç–æ–π", b: "–°–æ–±—ã—Ç–∏—è —á–∞—â–µ", req: 1000000, type: 'money', t: "1–ú –ë–•" },
        'üçñ': { n: "–ì–∏–≥–∞", b: "–î–æ—Ö–æ–¥ x5", req: 5000, type: 'clicks', t: "5000 –∫–ª–∏–∫–æ–≤" },
        'üêª': { n: "–ú–∏—à–∞", b: "–ö–ª–∏–∫ +1% –∞–≤—Ç–æ", req: 200, type: 'nagets', t: "200 –Ω–∞–≥–µ—Ç—Å–æ–≤" }
    };

    function save() { localStorage.setItem('vova_vFinal_v1', JSON.stringify(state)); }

    document.getElementById('burger-btn').onclick = function(e) {
        vib('light');
        let bM = state.skins.current === 'üçñ' ? 5 : 1;
        let misha = state.skins.current === 'üêª' ? (state.auto * state.mult * 0.01) : 0;
        let val = (state.click + misha) * state.mult * locations[state.locIdx].m * bM;
        state.money += val; state.totalClicks++;
        
        const f = document.createElement('div'); f.className = 'f-text';
        f.style.left = e.clientX + 'px'; f.style.top = e.clientY + 'px';
        f.innerText = `+${Math.floor(val)}`; document.body.appendChild(f);
        setTimeout(() => f.remove(), 600);
        updateUI();
    };

    function updateUI() {
        document.getElementById('money-display').innerText = Math.floor(state.money).toLocaleString();
        document.getElementById('nagets-display').innerText = state.nagets;
        document.getElementById('prestige-display').innerText = state.prestigeGold;
        document.getElementById('burger-btn').innerText = state.skins.current;
        document.getElementById('loc-display').innerText = locations[state.locIdx].n;
        let bM = state.skins.current === 'üçñ' ? 5 : 1;
        document.getElementById('income-stats').innerText = `–ê–≤—Ç–æ: ${Math.floor(state.auto * state.mult * locations[state.locIdx].m * bM)}/—Å`;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–Ω–æ–ø–æ–∫
        document.querySelectorAll('.buy-btn').forEach(btn => {
            const id = btn.dataset.id;
            const type = btn.dataset.type;
            if (type === 'upg') {
                const u = upgrades.find(x => x.id === id);
                const lvl = state.upgLvl[id] || 0;
                const cost = u.cur === 'n' ? u.base : Math.floor(u.base * Math.pow(1.7, lvl));
                btn.disabled = u.cur === 'n' ? state.nagets < cost : state.money < cost;
            } else if (type === 'loc') {
                const idx = parseInt(id);
                if (state.locIdx !== idx) btn.disabled = state.money < locations[idx].req;
            }
        });
    }

    function render() {
        const cont = document.getElementById('shop-content');
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.toggle('active', b.id === 't-'+activeTab));
        cont.innerHTML = '';

        if (activeTab === 'upg') {
            upgrades.forEach(u => {
                const lvl = state.upgLvl[u.id] || 0;
                const cost = u.cur === 'n' ? u.base : Math.floor(u.base * Math.pow(1.7, lvl));
                cont.innerHTML += `<div class="item ${u.r}">
                    <b>${u.name} (–£—Ä.${lvl})</b><span class="profit">${u.d}</span>
                    <button class="buy-btn" data-id="${u.id}" data-type="upg" onclick="buyU('${u.id}')" style="${u.cur==='n'?'background:#ff6600':''}">
                        ${u.cur==='n'?'üçó ':''}${cost.toLocaleString()}
                    </button>
                </div>`;
            });
        } else if (activeTab === 'loc') {
            locations.forEach((l, i) => {
                cont.innerHTML += `<div class="item">
                    <b>${l.n} (x${l.m})</b>
                    <button class="buy-btn" data-id="${i}" data-type="loc" onclick="setL(${i})">
                        ${state.locIdx === i ? '–î–û–ú–ê' : '–ü–ï–†–ï–ï–ó–î: ' + l.req.toLocaleString()}
                    </button>
                </div>`;
            });
        } else if (activeTab === 'skin') {
            Object.entries(skinData).forEach(([icon, d]) => {
                const isUn = state.unlockedSkins.includes(icon);
                const prog = d.type === 'money' ? state.money : (d.type === 'clicks' ? state.totalClicks : state.nagets);
                const can = prog >= d.req || isUn;
                cont.innerHTML += `<div class="item ${isUn?'legendary':''}">
                    <b>${icon} ${d.n}</b><small>${d.b}</small><br>
                    <small style="color:var(--gold)">${d.t}: ${Math.floor(prog)}/${d.req}</small>
                    <button class="buy-btn" onclick="unlS('${icon}', ${can})" style="background:${isUn?'#444':''}" ${!can && !isUn ? 'disabled' : ''}>
                        ${isUn ? (state.skins.current === icon ? '–ê–ö–¢–ò–í–ï–ù' : '–í–´–ë–†–ê–¢–¨') : '–ó–ê–ö–†–´–¢–û'}
                    </button>
                </div>`;
            });
        } else if (activeTab === 'bunker') {
            let pot = Math.floor((state.money * state.nagets) / 10000);
            cont.innerHTML = `<div class="item legendary" style="text-align:center">
                <b>üëë –ë–£–ù–ö–ï–† –í–û–í–´</b>
                <p>–ó–æ–ª–æ—Ç–æ: ${state.prestigeGold}</p>
                <p>–ü—Ä–∏ –ø—Ä–µ—Å—Ç–∏–∂–µ: <span style="color:var(--gold)">+${pot} üëë</span></p>
                <button class="buy-btn" style="background:#c0392b" onclick="pres()" ${pot <= 0 ? 'disabled' : ''}>–°–ë–†–û–° –ò –ü–†–ï–°–¢–ò–ñ</button>
            </div>`;
        }
        updateUI();
    }

    window.buyU = (id) => {
        const u = upgrades.find(x => x.id === id);
        const lvl = state.upgLvl[id] || 0;
        const cost = u.cur === 'n' ? u.base : Math.floor(u.base * Math.pow(1.7, lvl));
        if (u.cur === 'n' ? state.nagets >= cost : state.money >= cost) {
            vib('medium'); if (u.cur === 'n') state.nagets -= cost; else state.money -= cost;
            if (u.type === 'click') state.click += u.pow; if (u.type === 'auto') state.auto += u.pow; if (u.type === 'mult') state.mult *= u.pow;
            state.upgLvl[id] = lvl + 1; save(); render();
        }
    };

    window.setL = (i) => { if (state.money >= locations[i].req) { vib('medium'); state.locIdx = i; save(); render(); } };
    window.unlS = (icon, can) => { if (can && !state.unlockedSkins.includes(icon)) state.unlockedSkins.push(icon); if (state.unlockedSkins.includes(icon)) state.skins.current = icon; save(); render(); };
    window.pres = () => { if (confirm("–°–±—Ä–æ—Å–∏—Ç—å –≤—Å—ë —Ä–∞–¥–∏ –∑–æ–ª–æ—Ç–∞?")) { state.prestigeGold += Math.floor((state.money * state.nagets) / 10000); state.money=0; state.nagets=0; state.click=1; state.auto=0; state.mult=1; state.locIdx=0; state.upgLvl={}; state.totalClicks=0; save(); location.reload(); } };
    window.changeTab = (t) => { activeTab = t; render(); };

    function startStorm() {
        const overlay = document.getElementById('dima-game');
        overlay.style.display = 'flex';
        let tl = 10;
        let timer = setInterval(() => { tl--; document.getElementById('game-timer').innerText = tl; if(tl <= 0){ clearInterval(timer); overlay.style.display='none'; } }, 1000);
        let spawner = setInterval(() => {
            if(tl <= 0){ clearInterval(spawner); return; }
            const n = document.createElement('div'); n.className = 'falling-nagets'; n.innerText = 'üçó';
            n.style.left = Math.random() * 85 + '%'; n.style.top = '-50px';
            overlay.appendChild(n);
            n.animate([{ top: '-50px' }, { top: '100vh' }], { duration: 2000 });
            
            const collect = () => { if(!n.dataset.c){ vib('medium'); n.dataset.c=1; state.nagets++; updateUI(); n.style.transform='scale(2.5)'; n.style.opacity='0'; setTimeout(()=>n.remove(), 200); } };
            n.onmouseover = () => { if(mDown) collect(); };
            n.ontouchmove = (e) => { let t = e.touches[0]; let el = document.elementFromPoint(t.clientX, t.clientY); if(el && el.className === 'falling-nagets') collect(); };
            n.onmousedown = collect;
            setTimeout(() => n.remove(), 2000);
        }, 300);
    }

    setInterval(() => { state.money += (state.auto * state.mult * locations[state.locIdx].m * (state.skins.current === 'üçñ' ? 5 : 1)) / 10; updateUI(); }, 100);
    setInterval(() => { if(Math.random() < (state.skins.current === 'üìÄ' ? 0.6 : 0.2)) startStorm(); }, 35000);
    
    render();
</script>
</body>
</html>
